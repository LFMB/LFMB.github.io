--- 
layout: default
title: Home
order: 1
permalink: /
---
<!-- <script src="https://openfin.github.io/fin-hypergrid/build/fin-hypergrid.js"></script> -->
<script src="http://d3js.org/d3.v3.min.js"></script>
<div class="home">
    <section class="container-fluid hero-banner">
        <div class="intro-text">
            <h2 class="name">{{ site.title }}</h2>
            <p class="hero-tagline">{{ site.description }}</p>
        </div>
        <div class="arrow-bounce-down">
            <i class="fa fa-2x fa-angle-down"></i>
        </div>
    </section>
    <!-- hypergrid chart - it's just too vertical to be useful
    <section class="state-of-union">
        <div id="state-of-union-grid"></div>
    </section>
    -->
    <section class="usa-map-container text-center">
        <h2 class="state-of-union-map-title">State of the Union</h2>
        <p class="state-of-union-blurb">2015 Q1 Per Capita Breakdown of Grand Domestic Product (GDP) by state compared to national average</p>
        <div id="usa-map">
        </div>
        <p class="state-of-union-methodology-blurb">
        Took the most current (2015) United States Population statistics from the <a href="http://www.census.gov/popest/data/index.html" target="_blank">United States Census Bureau</a> coupled with the 2015 and available 2016 Quartely GDP numbers by state from the <a href="http://www.bea.gov/newsreleases/regional/gdp_state/qgsp_newsrelease.htm" target="_blank">Bureau of Economic Analysis</a> and used the data to generate per capita breakdowns by state looking at actual and percent difference from national mean. 
        </p>
    </section>
</div>

<script type="text/javascript">
var containerWidth = document.querySelector('.usa-map-container').clientWidth,
	height = 500,
	width;


if(containerWidth > 840){
	width = containerWidth;
} else {
	width = 960;
}




// window.data = {};

var projection = d3.geo.albersUsa()
    .translate([width / 2, height / 2])
    .scale([1000]); // scale things down so see entire US

var path = d3.geo.path().projection(projection);

// Define linear scale for output
var color = d3.scale.linear()
    .range(["rgb(255,0,0)", "rgb(255,255,255)", "rgb(0,128,0)"]);

var legendText = ["Above", "Average", "Below", "Nada"];

//Create SVG element and append map to the SVG
var svg = d3.select("#usa-map")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

// Append Div for tooltip to SVG
var div = d3.select("#usa-map")
    .append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

// Load in my states data!
d3.json("data/per-capita-gdp.json", function(data) {


    var max2015q1 = d3.max(data.states, function(d) {
        return d["2015-Q1"]
    });
    var min2015q1 = d3.min(data.states, function(d) {
        return d["2015-Q1"]
    });


    color.domain([min2015q1, 0, max2015q1]);


    // Load GeoJSON data and merge with states data
    d3.json("data/us-states.json", function(json) {

        let stateName = '',
            stateDiff = 0;

    	const q1GDP2015 = data.states.map(state => ({
            gdpDif: state["2015-Q1"],
            state: state.state
        }));

        function filterByPropertiesName(obj) {
            if (obj.properties.name === stateName) {
                obj.properties.diff = stateDiff;
            }
        }


        for (let a = 0; a < q1GDP2015.length; a++) {
            stateName = q1GDP2015[a]['state'];
            stateDiff = q1GDP2015[a]['gdpDif'];

            json.features.filter(filterByPropertiesName);
        }

        

        // Bind the data to the SVG and create one path per GeoJSON feature
        svg.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("stroke", "#000")
            .style("stroke-width", "1")
            .style("fill", function(d) {

                // Get data value
                var value = d.properties["diff"];

                if (value) {
                    //If value exists…
                    return color(value);
                } else {
                    //If value is undefined…
                   return "rgb(213,222,217)";
                }
               
            });



        // Modified Legend Code from Mike Bostock: http://bl.ocks.org/mbostock/3888852
       
        var legend = d3.select("#usa-map").append("svg")
            .attr("class", "legend")
            .attr("width", 100)
            .attr("height", 80)
            .selectAll("g")
            .data(color.domain().slice().reverse())
            .enter()
            .append("g")
            .attr("transform", function(d, i) {
                return "translate(0," + i * 20 + ")";
            });

        legend.append("rect")
            .attr("width", 18)
            .attr("height", 18)
            .style("fill", color);

        legend.append("text")
            .data(legendText)
            .attr("x", 24)
            .attr("y", 9)
            .attr("dy", ".35em")
            .text(function(d) {
                return d;
            });
       
    });

});
</script>
